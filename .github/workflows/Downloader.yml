# 工作流名称
name: Run OpenList and Veiled Journeys Downloader

# 工作流触发器：手动触发 (workflow_dispatch)
on:
  workflow_dispatch:

# 全局环境变量
env:
  CHROOT_DIR: /mnt/minisys
  BACKUP_FILE: minisys_backup.tar.gz
  WEBDAV_REMOTE_PATH: "backup"
  PAT: ${{ secrets.YUNZAIBOT_PAT }} 

# 作业定义
jobs:
  build-and-run:
    # 运行环境
    runs-on: ubuntu-latest
    
    # 作业步骤
    steps:
      - name: 1. 安装所需依赖 (Install dependencies)
        run: |
          echo "正在安装 rclone 和 pigz (用于多线程压缩)..."
          sudo apt-get update
          pip install --upgrade pip
          pip install requests tqdm py7zr webdavclient3 raffle upstash-redis 
          echo "✅ 依赖安装完毕。"

      - name: 2. 克隆下载器仓库 (Clone Downloader Repository)
        run: git clone https://x-access-token:${PAT}@github.com/Jyf0214/veiled-journeys.git

      - name: 3. 运行 Kemono 下载器 (Run Kemono Downloader)
        run: |
          echo "正在运行 Kemono 下载器..."
          python veiled-journeys/kemono_downloader.py
          echo "✅ Kemono 下载器执行完毕。"